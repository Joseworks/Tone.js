<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Tone.js Source: core/Note.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	
	<link type="text/css" rel="stylesheet" href="styles/site.spacelab.css">
	
</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">Tone.js</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="Tone.html">Tone</a>
						</li>
						
						<li>
							<a href="Tone.Abs.html">Abs</a>
						</li>
						
						<li>
							<a href="Tone.Add.html">Add</a>
						</li>
						
						<li>
							<a href="Tone.AmplitudeEnvelope.html">AmplitudeEnvelope</a>
						</li>
						
						<li>
							<a href="Tone.AMSynth.html">AMSynth</a>
						</li>
						
						<li>
							<a href="Tone.AND.html">AND</a>
						</li>
						
						<li>
							<a href="Tone.AudioToGain.html">AudioToGain</a>
						</li>
						
						<li>
							<a href="Tone.AutoPanner.html">AutoPanner</a>
						</li>
						
						<li>
							<a href="Tone.AutoWah.html">AutoWah</a>
						</li>
						
						<li>
							<a href="Tone.BitCrusher.html">BitCrusher</a>
						</li>
						
						<li>
							<a href="Tone.Buffer.html">Buffer</a>
						</li>
						
						<li>
							<a href="Tone.Chebyshev.html">Chebyshev</a>
						</li>
						
						<li>
							<a href="Tone.Chorus.html">Chorus</a>
						</li>
						
						<li>
							<a href="Tone.Clip.html">Clip</a>
						</li>
						
						<li>
							<a href="Tone.Clock.html">Clock</a>
						</li>
						
						<li>
							<a href="Tone.Compressor.html">Compressor</a>
						</li>
						
						<li>
							<a href="Tone.Convolver.html">Convolver</a>
						</li>
						
						<li>
							<a href="Tone.Distortion.html">Distortion</a>
						</li>
						
						<li>
							<a href="Tone.Divide.html">Divide</a>
						</li>
						
						<li>
							<a href="Tone.DryWet.html">DryWet</a>
						</li>
						
						<li>
							<a href="Tone.DuoSynth.html">DuoSynth</a>
						</li>
						
						<li>
							<a href="Tone.Effect.html">Effect</a>
						</li>
						
						<li>
							<a href="Tone.Envelope.html">Envelope</a>
						</li>
						
						<li>
							<a href="Tone.EQ.html">EQ</a>
						</li>
						
						<li>
							<a href="Tone.Equal.html">Equal</a>
						</li>
						
						<li>
							<a href="Tone.EqualPowerGain.html">EqualPowerGain</a>
						</li>
						
						<li>
							<a href="Tone.EqualZero.html">EqualZero</a>
						</li>
						
						<li>
							<a href="Tone.Expr.html">Expr</a>
						</li>
						
						<li>
							<a href="Tone.FeedbackCombFilter.html">FeedbackCombFilter</a>
						</li>
						
						<li>
							<a href="Tone.FeedbackDelay.html">FeedbackDelay</a>
						</li>
						
						<li>
							<a href="Tone.FeedbackEffect.html">FeedbackEffect</a>
						</li>
						
						<li>
							<a href="Tone.Filter.html">Filter</a>
						</li>
						
						<li>
							<a href="Tone.FMSynth.html">FMSynth</a>
						</li>
						
						<li>
							<a href="Tone.Follower.html">Follower</a>
						</li>
						
						<li>
							<a href="Tone.Freeverb.html">Freeverb</a>
						</li>
						
						<li>
							<a href="Tone.Gate.html">Gate</a>
						</li>
						
						<li>
							<a href="Tone.GreaterThan.html">GreaterThan</a>
						</li>
						
						<li>
							<a href="Tone.GreaterThanZero.html">GreaterThanZero</a>
						</li>
						
						<li>
							<a href="Tone.IfThenElse.html">IfThenElse</a>
						</li>
						
						<li>
							<a href="Tone.Instrument.html">Instrument</a>
						</li>
						
						<li>
							<a href="Tone.Inverse.html">Inverse</a>
						</li>
						
						<li>
							<a href="Tone.JCReverb.html">JCReverb</a>
						</li>
						
						<li>
							<a href="Tone.LessThan.html">LessThan</a>
						</li>
						
						<li>
							<a href="Tone.LFO.html">LFO</a>
						</li>
						
						<li>
							<a href="Tone.Limiter.html">Limiter</a>
						</li>
						
						<li>
							<a href="Tone.LowpassCombFilter.html">LowpassCombFilter</a>
						</li>
						
						<li>
							<a href="Tone.Master.html">Master</a>
						</li>
						
						<li>
							<a href="Tone.Max.html">Max</a>
						</li>
						
						<li>
							<a href="Tone.Merge.html">Merge</a>
						</li>
						
						<li>
							<a href="Tone.Meter.html">Meter</a>
						</li>
						
						<li>
							<a href="Tone.Microphone.html">Microphone</a>
						</li>
						
						<li>
							<a href="Tone.MidSideEffect.html">MidSideEffect</a>
						</li>
						
						<li>
							<a href="Tone.Min.html">Min</a>
						</li>
						
						<li>
							<a href="Tone.Modulo.html">Modulo</a>
						</li>
						
						<li>
							<a href="Tone.Mono.html">Mono</a>
						</li>
						
						<li>
							<a href="Tone.Monophonic.html">Monophonic</a>
						</li>
						
						<li>
							<a href="Tone.MonoSynth.html">MonoSynth</a>
						</li>
						
						<li>
							<a href="Tone.MultibandCompressor.html">MultibandCompressor</a>
						</li>
						
						<li>
							<a href="Tone.MultibandSplit.html">MultibandSplit</a>
						</li>
						
						<li>
							<a href="Tone.Multiply.html">Multiply</a>
						</li>
						
						<li>
							<a href="Tone.MultiSampler.html">MultiSampler</a>
						</li>
						
						<li>
							<a href="Tone.Negate.html">Negate</a>
						</li>
						
						<li>
							<a href="Tone.Noise.html">Noise</a>
						</li>
						
						<li>
							<a href="Tone.NoiseSynth.html">NoiseSynth</a>
						</li>
						
						<li>
							<a href="Tone.Normalize.html">Normalize</a>
						</li>
						
						<li>
							<a href="Tone.NOT.html">NOT</a>
						</li>
						
						<li>
							<a href="Tone.Note.html">Note</a>
						</li>
						
						<li>
							<a href="Tone.OmniOscillator.html">OmniOscillator</a>
						</li>
						
						<li>
							<a href="Tone.OR.html">OR</a>
						</li>
						
						<li>
							<a href="Tone.Oscillator.html">Oscillator</a>
						</li>
						
						<li>
							<a href="Tone.Panner.html">Panner</a>
						</li>
						
						<li>
							<a href="Tone.PanVol.html">PanVol</a>
						</li>
						
						<li>
							<a href="Tone.Phaser.html">Phaser</a>
						</li>
						
						<li>
							<a href="Tone.PingPongDelay.html">PingPongDelay</a>
						</li>
						
						<li>
							<a href="Tone.Player.html">Player</a>
						</li>
						
						<li>
							<a href="Tone.PluckSynth.html">PluckSynth</a>
						</li>
						
						<li>
							<a href="Tone.PolySynth.html">PolySynth</a>
						</li>
						
						<li>
							<a href="Tone.Pow.html">Pow</a>
						</li>
						
						<li>
							<a href="Tone.PulseOscillator.html">PulseOscillator</a>
						</li>
						
						<li>
							<a href="Tone.PWMOscillator.html">PWMOscillator</a>
						</li>
						
						<li>
							<a href="Tone.Recorder.html">Recorder</a>
						</li>
						
						<li>
							<a href="Tone.Route.html">Route</a>
						</li>
						
						<li>
							<a href="Tone.Sampler.html">Sampler</a>
						</li>
						
						<li>
							<a href="Tone.Scale.html">Scale</a>
						</li>
						
						<li>
							<a href="Tone.ScaledEnvelope.html">ScaledEnvelope</a>
						</li>
						
						<li>
							<a href="Tone.ScaleExp.html">ScaleExp</a>
						</li>
						
						<li>
							<a href="Tone.Select.html">Select</a>
						</li>
						
						<li>
							<a href="Tone.Signal.html">Signal</a>
						</li>
						
						<li>
							<a href="Tone.SignalBase.html">SignalBase</a>
						</li>
						
						<li>
							<a href="Tone.Source.html">Source</a>
						</li>
						
						<li>
							<a href="Tone.Split.html">Split</a>
						</li>
						
						<li>
							<a href="Tone.StereoEffect.html">StereoEffect</a>
						</li>
						
						<li>
							<a href="Tone.StereoFeedbackEffect.html">StereoFeedbackEffect</a>
						</li>
						
						<li>
							<a href="Tone.StereoWidener.html">StereoWidener</a>
						</li>
						
						<li>
							<a href="Tone.StereoXFeedbackEffect.html">StereoXFeedbackEffect</a>
						</li>
						
						<li>
							<a href="Tone.Subtract.html">Subtract</a>
						</li>
						
						<li>
							<a href="Tone.Switch.html">Switch</a>
						</li>
						
						<li>
							<a href="Tone.Threshold.html">Threshold</a>
						</li>
						
						<li>
							<a href="Tone.Transport.html">Transport</a>
						</li>
						
						<li>
							<a href="Tone.WaveShaper.html">WaveShaper</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: core/Note.js</h1>
    
    <section>
        <article>
            <pre class="sunlight-highlight-javascript linenums">define(["Tone/core/Tone", "Tone/core/Transport"], function(Tone){

	"use strict";

	/**
	 *  @class  A timed note. Creating a note will register a callback 
	 *          which will be invoked on the channel at the time with
	 *          whatever value was specified. 
	 *
	 *  @constructor
	 *  @param {number|string} channel the channel name of the note
	 *  @param {Tone.Time} time the time when the note will occur
	 *  @param {string|number|Object|Array} value the value of the note
	 */
	Tone.Note = function(channel, time, value){

		/**
		 *  the value of the note. This value is returned
		 *  when the channel callback is invoked.
		 *  
		 *  @type {string|number|Object}
		 */
		this.value = value;

		/**
		 *  the channel name or number
		 *  
		 *  @type {string|number}
		 *  @private
		 */
		this._channel = channel;

		/**
		 *  an internal reference to the id of the timeline
		 *  callback which is set. 
		 *  
		 *  @type {number}
		 *  @private
		 */
		this._timelineID = Tone.Transport.setTimeline(this._trigger.bind(this), time);
	};

	/**
	 *  invoked by the timeline
	 *  @private
	 *  @param {number} time the time at which the note should play
	 */
	Tone.Note.prototype._trigger = function(time){
		//invoke the callback
		channelCallbacks(this._channel, time, this.value);
	};

	/**
	 *  clean up
	 */
	Tone.Note.prototype.dispose = function(){ 
		Tone.Tranport.clearTimeline(this._timelineID);
		this.value = null;
	};

	/**
	 *  @private
	 *  @static
	 *  @type {Object}
	 */
	var NoteChannels = {};

	/**
	 *  invoke all of the callbacks on a specific channel
	 *  @private
	 */
	function channelCallbacks(channel, time, value){
		if (NoteChannels.hasOwnProperty(channel)){
			var callbacks = NoteChannels[channel];
			for (var i = 0, len = callbacks.length; i &lt; len; i++){
				var callback = callbacks[i];
				if (Array.isArray(value)){
					callback.apply(window, [time].concat(value));
				} else {
					callback(time, value);
				}
			}
		}
	}

	/**
	 *  listen to a specific channel, get all of the note callbacks
	 *  @static
	 *  @param {string|number} channel the channel to route note events from
	 *  @param {function(*)} callback callback to be invoked when a note will occur
	 *                                        on the specified channel
	 */
	Tone.Note.route = function(channel, callback){
		if (NoteChannels.hasOwnProperty(channel)){
			NoteChannels[channel].push(callback);
		} else {
			NoteChannels[channel] = [callback];
		}
	};

	/**
	 *  remove a callback from a channel
	 *  @static
	 */
	Tone.Note.unroute = function(channel, callback){
		if (NoteChannels.hasOwnProperty(channel)){
			var channelCallback = NoteChannels[channel];
			var index = channelCallback.indexOf(callback);
			if (index !== -1){
				NoteChannels[channel].splice(index, 1);
			}
		}
	};

	/**
	 *  Parses a score and registers all of the notes along the timeline. 
	 *
	 *  Scores are a JSON object with instruments at the top level
	 *  and an array of time and values. The value of a note can be 0 or more 
	 *  parameters. 
	 *
	 *  The only requirement for the score format is that the time is the first (or only)
	 *  value in the array. All other values are optional and will be passed into the callback
	 *  function registered using ""
	 *
	 *  ```javascript
	 *  var score = { 
	 *  	"synth"  : [["0", "C3"], ["0:1", "D3"], ["0:2", "E3"], ... ],
	 *  	"bass"  : [["0", "C2"], ["1:0", "A2"], ["2:0", "C2"], ["3:0", "A2"], ... ],
	 *  	"kick"  : ["0", "0:2", "1:0", "1:2", "2:0", ... ],
	 *  	//...
	 *  };
	 *  ```
	 *  
	 *  To convert MIDI files to score notation, take a look at utils/MidiToScore.js
	 *
	 *  @static
	 *  @param {Object} score
	 *  @return {Array&lt;Tone.Note>} an array of all of the notes that were created
	 */
	Tone.Note.parseScore = function(score){
		var notes = [];
		for (var inst in score){
			var part = score[inst];
			if (inst === "tempo"){
				Tone.Transport.setBpm(part);
			} else if (inst === "timeSignature"){
				Tone.Transport.setTimeSignature(part[0], part[1]);
			} else if (Array.isArray(part)){
				for (var i = 0; i &lt; part.length; i++){
					var noteDescription = part[i];
					var note;
					if (Array.isArray(noteDescription)){
						var time = noteDescription[0];
						var value = noteDescription.slice(1);
						note = new Tone.Note(inst, time, value);
					} else {
						note = new Tone.Note(inst, noteDescription);
					}
					notes.push(note);
				}
			} else {
				throw new TypeError("score parts must be Arrays");
			}
		}
		return notes;
	};

	///////////////////////////////////////////////////////////////////////////
	//	MUSIC NOTES
	//	
	//	Augments Tone.prototype to include note methods
	///////////////////////////////////////////////////////////////////////////

	var noteToIndex = { "c" : 0, "c#" : 1, "db" : 1, "d" : 2, "d#" : 3, "eb" : 3, 
		"e" : 4, "f" : 5, "f#" : 6, "gb" : 6, "g" : 7, "g#" : 8, "ab" : 8, 
		"a" : 9, "a#" : 10, "bb" : 10, "b" : 11
	};

	var noteIndexToNote = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];

	var middleC = 261.6255653005986;

	/**
	 *  convert a note name to frequency (i.e. A4 to 440)
	 *  defined in "Tone/core/Note"
	 *  
	 *  @param  {string} note
	 *  @return {number}         
	 */
	Tone.prototype.noteToFrequency = function(note){
		//break apart the note by frequency and octave
		var parts = note.split(/(\d+)/);
		if (parts.length === 3){
			var index = noteToIndex[parts[0].toLowerCase()];
			var octave = parts[1];
			var noteNumber = index + parseInt(octave, 10) * 12;
			return Math.pow(2, (noteNumber - 48) / 12) * middleC;
		} else {
			return 0;
		}
	};

	/**
	 *  convert a note name (i.e. A4, C#5, etc to a frequency)
	 *  defined in "Tone/core/Note"
	 *  
	 *  @param  {number} freq
	 *  @return {string}         
	 */
	Tone.prototype.frequencyToNote = function(freq){
		var log = Math.log(freq / middleC) / Math.LN2;
		var noteNumber = Math.round(12 * log) + 48;
		var octave = Math.floor(noteNumber/12);
		var noteName = noteIndexToNote[noteNumber % 12];
		return noteName + octave.toString();
	};

	/**
	 *  convert an interval (in semitones) to a frequency ratio
	 *  defined in "Tone/core/Note"
	 *
	 *  ```javascript
	 *  tone.intervalToFrequencyRatio(0); // returns 1
	 *  tone.intervalToFrequencyRatio(12); // returns 2
	 *  ```
	 *  
	 *  @param  {number} interval the number of semitones above the base note
	 *  @return {number}          the frequency ratio
	 */
	Tone.prototype.intervalToFrequencyRatio = function(interval){
		return Math.pow(2,(interval/12));
	};

	/**
	 *  convert a midi note number into a note name
	 *  defined in "Tone/core/Note"
	 *
	 *  ```javascript
	 *  tone.midiToNote(60); // returns "C3"
	 *  ```
	 *  
	 *  @param  {number} midiNumber the midi note number
	 *  @return {string}            the note's name and octave
	 */
	Tone.prototype.midiToNote = function(midiNumber){
		var octave = Math.floor(midiNumber / 12) - 2;
		var note = midiNumber % 12;
		return noteIndexToNote[note] + octave;
	};

	/**
	 *  convert a note to it's midi value
	 *  defined in "Tone/core/Note"
	 *
	 *  ```javascript
	 *  tone.noteToMidi("C3"); // returns 60
	 *  ```
	 *  
	 *  @param  {string} note the note name (i.e. "C3")
	 *  @return {number} the midi value of that note
	 */
	Tone.prototype.noteToMidi = function(note){
		//break apart the note by frequency and octave
		var parts = note.split(/(\d+)/);
		if (parts.length === 3){
			var index = noteToIndex[parts[0].toLowerCase()];
			var octave = parts[1];
			return index + (parseInt(octave, 10) + 2) * 12;
		} else {
			return 0;
		}
	};

	return Tone.Note;
});</pre>
        </article>
    </section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					
		<span class="jsdoc-message">
		Documentation generated on Wed Dec 03 2014 22:50:18 GMT-0500 (EST).
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<script src="scripts/sunlight.js"></script>
	<script src="scripts/sunlight.javascript.js"></script>
	<script src="scripts/sunlight-plugin.doclinks.js"></script>
	<script src="scripts/sunlight-plugin.linenumbers.js"></script>
	<script src="scripts/sunlight-plugin.menu.js"></script>
	<script src="scripts/jquery.min.js"></script>
	<script src="scripts/jquery.scrollTo.js"></script>
	<script src="scripts/jquery.localScroll.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>


	<script>  Sunlight.highlightAll({lineNumbers:true,  showMenu: true, enableDoclinks :true}); </script>

	<script>
		$( function () {
			$( "#toc" ).toc( {
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : 60
			} );
			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );

		} );
	</script>

	

</body>
</html>
